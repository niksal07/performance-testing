name: "performance testing"

on: 
    push: 
        branches: 
            main


jobs:
    on-push:
        if: github.event_name == 'push'
        runs-on: ubuntu-latest
        steps:
            - name: "checkout code"
              uses: actions/checkout@v3
            - name: "setup python"
              uses: actions/setup-python@v4
              with:
                python-version: "3.12"
            - name: "start flask app"
              run: |
                python3 -m venv venv
                nohup flask run &
                sleep 15
            - name: "install k6"
              run: |
                sudo apt install -y gnupg ca-certificates
                curl -s https://k6.io/key.gpg | sudo apt-key add -
                echo "deb https://dl.k6.io/deb stable main" | sudo tee /etc/apt/sources.list.d/k6.list
                sudo apt update
                sudo apt install -y k6

            - name: "run test on k6"
              run: k6 run test.js